---
title: "BirdAlignment"
author: "Ferris"
date: "13/04/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ape)
library(reshape2)
```

## Alignment

Continuation of Remaking Tree Rough Work, but ferris attempt

```{r cars}
Sequences <- read.csv("Sequences.csv")
Sequences$Sequence <- as.character(Sequences$Sequence)

# Now work on aligning the sequences and so on
BDNA<-sapply(Sequences$Sequence,strsplit,split="")
#head(BDNA)
#str(BDNA)
#View(BDNA)
#names(BDNA)
#head(Sequences$Name)
names(BDNA)<-paste(1:nrow(Sequences),Sequences$Name, sep = "_") #combine row number with sequence ID as new identifiers
#names(BDNA)
# didn't really need to do that step but oh well

#now need to convert it to a DNA bin object
BDNA1<- as.DNAbin(BDNA)
#head(BDNA1)
BAlign<- ape::muscle(BDNA1, quiet = FALSE)
#head(BAlign)
#str(BAlign)

#Checking
#checkAlignment(BAlign, what = 1) #there are ZERO sites with only 1 possible base pair... that suggest to me that not all of these genes are the same cytochrome B
#checkAlignment(BAlign, what = 2)
#checkAlignment(BAlign, what = 3)
SeqLen<-as.numeric(lapply(BDNA1, length))
qplot(SeqLen)+theme_bw() #can see that some are not aligning fully- makes sense...I want to keep all of them though

# now distance matrix
#?dist.dna()
#BDM<-dist.dna(BAlign, model="K80") #all NaN :/
BDM <- dist.dna(BAlign, model = "raw", pairwise.deletion=TRUE, as.matrix = TRUE) #check if distances are above 0.75
class(BDM)
length(BDM)
BDMmat<-as.matrix(BDM)
dim(BDMmat)

# want to plot our distance matrix, but need to collapse the same data into 3 columns
PDat<- melt(BDMmat)
View(PDat)

#chop the very long names down to just species name.
PDat$Var1 <- gsub("()(cytochrome b \\(cytb\\) gene, partial cds; mitochondrial)", "\\1", PDat$Var1)
PDat$Var1 <- gsub("(.{13})(\\s)(\\w+)(\\s)(\\w+)", "\\2\\3\\4\\5", PDat$Var1)
PDat$Var1 <- gsub("[1-9]", "", PDat$Var1)
PDat$Var2 <- gsub("()(cytochrome b \\(cytb\\) gene, partial cds; mitochondrial)", "\\1", PDat$Var2)
PDat$Var2 <- gsub("(.{13})(\\s)(\\w+)(\\s)(\\w+)", "\\2\\3\\4\\5", PDat$Var2)
PDat$Var2 <- gsub("[1-9]", "", PDat$Var2)

ggplot(data=PDat, aes(x=Var1,y=Var2,fill=value))+geom_tile() #hard to see since two sequences very different from the rest but similar to each other
ggplot(data=PDat, aes(x=Var1,y=Var2,fill=value))+geom_tile()+scale_fill_gradientn(colours=c("white","blue","green","red"))

# somethings not working- all Nans
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
